<main class="relative h-screen w-screen overflow-hidden bg-stone-950">
    <!-- Animated background blobs for 'liquid glass' effect -->
    <div class="absolute top-0 -left-4 w-72 h-72 bg-purple-600 liquid-blob"></div>
    <div class="absolute -bottom-8 -right-4 w-72 h-72 bg-sky-600 liquid-blob"></div>
    <div class="absolute top-1/4 -right-12 w-72 h-72 bg-emerald-500 liquid-blob animate-pulse"></div>

    <div class="relative z-10 h-full w-full flex flex-col">
        <!-- Main content area -->
        <div class="flex-grow overflow-y-auto">
            @switch (currentView()) {
                @case ('dashboard') {
                    <app-dashboard-view [dailyLog]="dailyLog()" [goals]="dailyGoals()" />
                }
                @case ('camera') {
                    <app-camera-view (imageCaptured)="onImageCaptured($event)" />
                }
                 @case ('barcode') {
                    <app-barcode-scanner (barcodeScanned)="onBarcodeScanned($event)" (scanError)="onScanError($event)" />
                }
                @case ('analysis') {
                    <app-analysis-view 
                        [analysisResult]="analysisResult()"
                        (logFood)="onLogFood($event)"
                        (discard)="onDiscardAnalysis()" />
                }
                @case ('settings') {
                    <app-goal-settings 
                        [currentGoals]="dailyGoals()"
                        (goalsSaved)="onGoalsSaved($event)"
                        (close)="changeView('dashboard')" />
                }
            }
        </div>

        <!-- Bottom Navigation Bar -->
        <nav class="flex-shrink-0 p-3">
            <div class="glass-card rounded-full flex justify-around items-center max-w-sm mx-auto p-2">
                <button (click)="changeView('dashboard')" class="p-3 rounded-full transition-colors" [class.bg-sky-500/50]="currentView() === 'dashboard'" [class.hover:bg-white/10]="currentView() !== 'dashboard'">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
                </button>
                 <button (click)="changeView('camera')" class="p-3 rounded-full transition-colors" [class.bg-sky-500/50]="currentView() === 'camera' || currentView() === 'analysis'" [class.hover:bg-white/10]="currentView() !== 'camera' && currentView() !== 'analysis'">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                </button>
                 <button (click)="changeView('barcode')" class="p-3 rounded-full transition-colors" [class.bg-sky-500/50]="currentView() === 'barcode'" [class.hover:bg-white/10]="currentView() !== 'barcode'">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg>
                </button>
                <button (click)="changeView('settings')" class="p-3 rounded-full transition-colors" [class.bg-sky-500/50]="currentView() === 'settings'" [class.hover:bg-white/10]="currentView() !== 'settings'">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                </button>
            </div>
        </nav>
    </div>

    <!-- Loading and Error Overlay -->
    @if(isLoading() || error()) {
        <div class="absolute inset-0 bg-black/70 backdrop-blur-md z-50 flex items-center justify-center p-8">
            @if(isLoading()) {
                <div class="flex flex-col items-center space-y-4">
                    <div class="loader"></div>
                    <p class="text-white font-semibold">Please wait...</p>
                </div>
            }
            @if(error(); as err) {
                <div class="text-center text-white space-y-4">
                    <h3 class="text-xl font-bold text-red-400">An Error Occurred</h3>
                    <p class="text-gray-300">{{ err }}</p>
                    <button (click)="clearError(); changeView('dashboard')" class="mt-4 px-4 py-2 bg-sky-500 rounded-lg font-semibold">
                        Go to Dashboard
                    </button>
                </div>
            }
        </div>
    }
</main>